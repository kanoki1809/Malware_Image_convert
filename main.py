import streamlit as st
import numpy as np
import os
import subprocess
import array
import glob
from PIL import Image



def pe_to_image(file_path):
 

  pe = pefile.PE(file_path)
  image = PIL.Image.new("RGB", (pe.OPTIONAL_HEADER.SizeOfImage, pe.OPTIONAL_HEADER.SizeOfImage))
  for i in range(pe.OPTIONAL_HEADER.SizeOfImage):
    image.putpixel((i % pe.OPTIONAL_HEADER.SizeOfImage, i // pe.OPTIONAL_HEADER.SizeOfImage), pe.sections[0].get_data()[i])
  return image

st.title('CONVERT PE FILE TO  IMAGE')

st.write('CHOOSE TYPE TO CONVERT')
type=st.radio('choose  depent',['file','folder'])

if type=='file':
        file = st.file_uploader('choose a pe file: ', type=([".exe", ".dll", ".ocx", ".sys", ".ime", ".cpl", ".bpl", ".ime", ".tlb", ".ocx", ".res", ".ax"]))
        len_pe = os.path.getsize(file)  #  lấy kích thước của tệp tin (độ dài tệp tin theo byte).
        width = 256 #chiều rộng ảnh
        rem = len_pe % width #kích thước dư
        a = array.array("B")  # tạo một mảng dữ liệu kiểu uint8 để lưu trữ thông tin hình ảnh
        a.fromfile(open_pe, len_pe - rem)#đọc nội dung tệp tin PE vào mảng dữ liệu hình ảnh, bỏ qua phần còn lại của tệp tin nếu kích thước không chia hết cho 256 byte.
        open_pe.close()
        g = numpy.reshape(a, (len(a) // width, width))# chuyển đổi mảng dữ liệu hình ảnh thành ma trận hình ảnh, có chiều rộng bằng 256 pixel.
        g = numpy.uint8(g) #chuyển đổi loại dữ liệu của ma trận hình ảnh thành uint8
        g = numpy.stack([g, g, g], axis=2) #chuyển đổi mảng dữ liệu thành mảng ba chiều
        g = Image.point([0, 255])
        g.save(g,'png')
        g.show()
else:
  uploaded_files = st.file_uploader("Upload your folder here...", accept_multiple_files=True, type=([".exe", ".dll", ".ocx", ".sys", ".ime", ".cpl", ".bpl", ".ime", ".tlb", ".ocx", ".res", ".ax"]))
  
  
